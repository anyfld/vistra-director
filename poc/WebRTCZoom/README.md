# WebRTC Camera Zoom Viewer

go2rtcの映像をズーム制御できるWebビューアです。

**配信側（スマホ）でカメラのズームを制御**し、受信側（PC）で視聴できます。

## 構成

```
┌─────────────────┐      ┌─────────────┐      ┌─────────────────┐
│  配信側（iPhone）│─────▶│   go2rtc    │─────▶│  視聴側（PC）   │
│  broadcast.html │      │   サーバー   │      │   index.html    │
│  ★ズーム制御    │      │             │      │   表示ズーム    │
└─────────────────┘      └─────────────┘      └─────────────────┘
```

## 機能

### 配信側（broadcast.html）
- 📹 **カメラ配信**: go2rtcへWebRTC配信
- 🔍 **カメラズーム**: Media Capture APIでiPhoneカメラのズームを制御
- 🔄 **カメラ切替**: 内カメラ/外カメラの切替

### 視聴側（index.html）
- 📺 **映像視聴**: go2rtcからWebRTC受信
- 🔎 **表示ズーム**: ブラウザ上でのデジタルズーム
- ↔️ **パン**: 表示位置の移動

## 使用方法

### 1. サーバーを起動

```bash
cd poc
uv run python WebRTCZoom/main.py --insecure
```

### 2. 配信側（iPhone）の設定

1. iPhoneのブラウザ（Safari推奨）で以下にアクセス：
   ```
   https://<PCのIPアドレス>:8443/broadcast.html
   ```
2. カメラへのアクセスを許可
3. go2rtcサーバーのURLを入力（例: `https://172.20.10.3`）
4. 「配信開始」ボタンをタップ
5. **ズームスライダーでカメラのズームを調整**

### 3. 視聴側（PC）の設定

1. ブラウザで `https://localhost:8443/` にアクセス
2. ストリーム名を入力して「接続」
3. 映像が表示される

## コマンドラインオプション

```bash
uv run python main.py --help
```

| オプション | 説明 | デフォルト |
|-----------|------|----------|
| `--port PORT` | サーバーポート番号 | 8443 |
| `--url URL` | go2rtcサーバーURL | https://172.20.10.3 |
| `--insecure` | SSL検証をスキップ | - |
| `--http` | HTTPモード（非推奨） | - |
| `--no-browser` | ブラウザを自動で開かない | - |

## ⚠️ 注意事項

### カメラズームのサポート

- **iOS Safari**: ズームがサポートされている（iOS 16以降推奨）
- **iOS Chrome**: WebKitベースのため、Safariと同様
- **Android Chrome**: 機種によりサポート状況が異なる

ズームがサポートされていない場合、配信ページに警告が表示されます。

### HTTPS必須

WebRTCとカメラアクセスにはHTTPSが必要です。自己署名証明書を使用しているため、ブラウザで警告が表示されます。

**iPhone/Safariの場合:**
1. 「この接続ではプライバシーが保護されません」と表示される
2. 「詳細を表示」→「このWebサイトを閲覧」をタップ

## トラブルシューティング

### カメラにアクセスできない

- ブラウザの設定でカメラへのアクセスを許可してください
- HTTPSでアクセスしていることを確認してください

### ズームが動作しない

- 「このカメラはズームをサポートしていません」と表示される場合、ブラウザまたはOSがカメラズーム制御に対応していません
- Safari（iOS）を使用することをお勧めします

### 配信が開始できない

- go2rtcサーバーが起動していることを確認
- サーバーURLが正しいことを確認
- ネットワーク接続を確認

## 技術詳細

### 使用API

- **MediaDevices.getUserMedia()**: カメラアクセス
- **MediaStreamTrack.applyConstraints()**: ズーム制御
- **WebRTC (WHIP/WHEP)**: go2rtcとの通信
- **CSS Transform**: 表示ズーム

### 対応ブラウザ

| ブラウザ | 配信 | 視聴 | ズーム |
|---------|------|------|--------|
| Safari (iOS) | ✅ | ✅ | ✅ (iOS 16+) |
| Chrome (iOS) | ✅ | ✅ | ✅ |
| Chrome (PC) | ✅ | ✅ | △ (外部カメラ依存) |
| Firefox | ✅ | ✅ | ❌ |

## ライセンス

MIT License

